---
title: "Data Analysis Pipeline - Leakiness and Shear"
author: "Lindsay Waldrop"
date: "9/24/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This data analysis pipeline is for after the simulations in IBAMR are complete, viz_IB2d zip files are downloaded and unziped. It assumes that these folders are in a folder named ``runs'' in the main git repository directory of entcode. 

This pipeline exists for two outputs: 
* shear around hairs, and
* leakiness through each row of the array.

For these values, we need to extract velocities from the data generated by IBAMR. The extraction will take place through VisIt (using a python script). In this script, VisIt will draw a line through the end hairs of the array and sample velocities along that line. For an example, in a 12-hair array, we would want to sample along the first row (hairs 1-3), the second row (hairs ), and the third row (hairs 8-12). See image below:
![12-hair array](runs_3row/Array12hairs.pdf)

In this array, the first row needs to be set from hair 3 to hair 2, the second row from hair 7 to hair 6 and the third row from hair 8 to hair 12. 

VisIt will write these velocitie values to a .curve file and store them in each viz_IB2d file in a folder called ``hairline''. Each row will need a separate analysis and hairline folder (named hairline1, hairline2, etc corresponding to the rows of hairs from closest to the antennule to furthest away). 

In order for VisIt to do this extraction, it needs to know where each hair exists in the doman for each array configuration in each simulation. Then these values need to be put in a standard form so that VisIt can read them automatically from the python script. 

## Setup for analysis: changing your generate R file

In order to do this, your generate_grid R file will need some changes. First, we have to build a way to generate a csv file with all the hair positions so we can recover those later. Second, we'll need to have a way to set up a file with the start and end hairs in a standard form that can be read by VisIt. 

First, let's write those csv files. In your code, you'll need to add the following line right before the end of the makehairs function: 

```{r,eval=FALSE}
  allhairs<-data.frame("a"=c(aN,0,0))
  names(allhairs)<-"a"
  for (i in 1:nohairs){
    hairx<-eval(as.name(paste("hair",i,"Centerx",sep="")))
    hairy<-eval(as.name(paste("hair",i,"Centery",sep="")))
    allhairs<-cbind(allhairs,"h"=c(hN,hairx,hairy))
  }
write.csv(allhairs,file=paste("hairs",number,".csv",sep=""),row.names = FALSE)
```

These lines should be inside the curly braces for the makehairs function but outside the last loop that prints out the points in hairs.vertex. In generate_grid2d_4row.R, these lines are located at lines 174 - 182. Be sure to define nohairs<- the number of hairs in your array somewhere above this chunk of code.

Running the vertex file code again will generate hair 

```{r,eval=FALSE}
starthair=8  #  first row start: 3, second row start: 7, third row start: 8
endhair=12    #  first row end: 2, second row end: 6, third row end: 12

```


