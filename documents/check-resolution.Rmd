---
title: "Check resolution of odor capture"
output: html_notebook
---
```{r setup}
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
library(ggplot2)
library(viridis)
library(RColorBrewer)
library(colorspace)
library(patchwork)
library(tidyr)
library(janitor)
library(dplyr)
```

## Rerun simulations at higher grid 

These simulations were rerun at 1024 grid size: 

 * 0001
 * 0235
 * 0468
 * 0906
 
The results were renamed with a 5 as the first digit of the run id. 

## Plotting results as a comparison

```{r}
source("./src/R-scripts/datahandling_functions.R")

plot_results <- function(hairno, run_id){
  hair_conc <- convert_odorconc(run_id, fluid, hairno)
  hair_dxdy <- hair_conc$dx * hair_conc$dy
  init_data <- R.matlab::readMat(paste("./results/odorcapture/", 
                                       hairno, "hair_array/", 
                                       "initdata_", run_id, ".mat", 
                                       sep = ""))
  hair_values <- apply(hair_conc$conc.data, 1, sum, na.rm = T)
  total_conc <- (hair_values * sum(hair_conc$hairdots)) * hair_dxdy
  hair_totals <- as.data.frame(total_conc)
  cmax <- hair_conc$cmax
  ctotal <- hair_conc$ctotal
  domain_area <- hair_conc$xlength * hair_conc$ylength
  norm_conc <- total_conc / as.vector(ctotal * domain_area)
  if(is.null(init_data$list.print.times)){
    print_times <- seq(0,by=init_data$dt,length.out = length(total_conc))
  }else{
    print_times <- as.numeric(init_data$list.print.times)
  }
  hair_totals <- data.frame("time" = print_times, 
                        "total_conc" = total_conc,
                       "norm_conc" = norm_conc)
    
  #for(i in seq(1,length(conc.timedata), by = 10)){
  #for (i in 1:length(conc.timedata)){
  #for (i in 1:50){
  p1 <- ggplot(hair_totals, 
                aes(time, total_conc)) + 
     geom_point(pch = 19, size = 1) + 
     scale_color_viridis(discrete = T, guide = "none") +
     ylab("Total concentration") + xlab("Simulation time (s)") +
     xlim(0, max(hair_totals$time)) + 
     ylim(0, max(hair_totals$total_conc)) + 
     theme_minimal()
   p2 <- ggplot(hair_totals, 
                aes(time, norm_conc)) + 
     geom_point(pch = 19, size = 1) + 
     ylab("Normalized concentration") + xlab("Simulation time (s)") +
     xlim(0, max(hair_totals$time)) + 
     ylim(0, max(hair_totals$norm_conc)) + 
     theme_minimal()
  dat <- list("hair_totals" = hair_totals, "p_total_conc" = p1, "p_norm_conc" = p2)
  return(dat)
}

sim0235 <- plot_results(3, "0235")
sim0235$hair_totals$simulation <- "0235"
sim5235 <- plot_results(3, "5235")
sim5235$hair_totals$simulation <- "5235"
sim0001 <- plot_results(3, "6001")
sim5001 <- plot_results(3, "5001")
```

```{r}
sim0235$p_total_conc + sim5235$p_total_conc

ggplot(sim_235_all, aes(time, total_conc, color = simulation)) + geom_point()
```
```{r}
sim0235$p_norm_conc + sim5235$p_norm_conc

sim_235_all <- rbind(sim0235$hair_totals, sim5235$hair_totals)

ggplot(sim_235_all, aes(time, norm_conc, color = simulation)) + geom_point()

```

```{r}
sim0001$p_norm_conc + sim5001$p_norm_conc
```

```{r}
sim0235$hair_totals$simulation <- 0235
sim0235$hair_totals$grid <- 512
sim5235$hair_totals$simulation <- 5235
sim5235$hair_totals$grid <- 1024

hair_totals <- rbind(sim0235$hair_totals, sim5235$hair_totals)

ggplot(hair_totals, aes(x = time, y = norm_conc, color = factor(grid))) + geom_point()
```

```{r}

```